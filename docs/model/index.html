<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Data model - Opereon</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://opereon.io/favicon.ico">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
  
  
  <link rel="stylesheet" href="/css/style.min.d670118d4cba510136568c7de9ccc185bb429c9d31ff6632f7a6a03cd87140e6.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home">
      <a href="/">
        <span>Home</span>
      </a>
    </li>
    
    <li class="menu-item-documentation">
      <a href="/docs/">
        <span>Documentation</span>
      </a>
    </li>
    
  </ul>
  
  <ul>
    
    <li class="navbar-icon"><a href="https://github.com/opereon/opereon"><i class="fab fa-github"></i></a></li>
    
  </ul>
  
</div>

  <div class="wrapper">
    <div class="header">
  <div class="logo">
    <a href="https://opereon.io"><img alt="Logo" src="/images/logo.svg" /></a>
  </div>
  <div class="logo-mobile">
    <a href="https://opereon.io"><img alt="Logo" src="/images/logo.svg" /></a>
  </div>
  <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home">
      <a href="/">
        <span>Home</span>
      </a>
    </li>
    
    <li class="menu-item-documentation active ">
      <a href="/docs/">
        <span>Documentation</span>
      </a>
    </li>
    
  </ul>
  
  <ul>
    
    <li class="navbar-icon"><a href="https://github.com/opereon/opereon"><i class="fab fa-github"></i></a></li>
    
  </ul>
  
</div>

  <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
</div>


    <h3 style="text-align: center">*** This website is still under active development. ***</h3>

    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<aside class="sidebar-menu">
  <ul class="sidebar-main-menu">
    
    <li>
      <a href="/docs/quickstart/" class="">Quick start</a>
      
    </li>
    
    <li>
      <a href="/docs/overview/" class="">Overview</a>
      
    </li>
    
    <li>
      <a href="/docs/install/" class="">Installation</a>
      
    </li>
    
    <li>
      <a href="/docs/model/" class="active">Data model</a>
      
        <nav id="TableOfContents">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#data-representation">Data representation</a>
<ul>
<li><a href="#manifest-file">Manifest file</a></li>
<li><a href="#settings-file">Settings file</a></li>
</ul></li>
</ul>
</nav>
      
    </li>
    
    <li>
      <a href="/docs/opath/" class="">Opath query language</a>
      
    </li>
    
    <li>
      <a href="/docs/template/" class="">Templates</a>
      
    </li>
    
    <li>
      <a href="/docs/procedures/" class="">Procedures</a>
      
    </li>
    
  </ul>
</aside>


          </div>
        </div>
        <div class="col-12 col-md-9">
          
<div class="content">
  <h1 class="title">Data model</h1>
  

<p>In our approach to ICT automation, everything is built around a concept of <strong>data model</strong> representing every piece of significant
information about the managed infrastructure in the form of a <strong>versioned</strong> <strong>file tree</strong>. All of the necessary facts about
managed hosts, users, services, etc. are represented by set of (mostly) textual files, that are easy to edit and
maintain.</p>

<p>The model is kept in a single <a href="https://git-scm.com">git</a> repository for change tracking. When used, the
data from files is then transformed into an generalized object tree, which can be traversed and searched with the use
of our own specialized data query language <a href="/docs/opath">Opath</a>.</p>

<h1 id="introduction">Introduction</h1>

<p>For illustration purposes, consider the following directory, containing some crucial pieces of information about a very
simple infrastructure, with one host named <code>server1</code> and one user account named <code>john</code>.</p>






<figure class="code" id="">
  
  <div class="buttons">
    <button class="fa fa-copy clipboard"></button>
  </div>
  <div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ascii-tree" data-lang="ascii-tree">. 
  hosts/
    server1/
      etc/
        ssh/
          ssh_host_rsa_key
          ssh_host_rsa_key.pub
      _.yaml    
  users/
    john/
      ssh/
        id_rsa.pub
      _.json  </code></pre></div>
</figure>


<p>Of particular interest in this discussion are the files presented below:</p>






<figure class="code" id="hosts/server1/_.yaml">
  
  <figcaption class="filename"><code>hosts/server1/_.yaml</code></figcaption>
  
  <div class="buttons">
    <button class="fa fa-copy clipboard"></button>
  </div>
  <div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">hostname: server1
domain: example.org
net:
  eth0:
    ip4:
      address: <span style="color:#ff0;font-weight:bold">192.168.1.100</span>
      mask: <span style="color:#ff0;font-weight:bold">255.255.255.0</span>
      gateway: <span style="color:#ff0;font-weight:bold">192.168.1.1</span>
packages: [mc, vim, nmap]</code></pre></td></tr></table>
</div>
</div>
</figure>







<figure class="code" id="users/john/_.json">
  
  <figcaption class="filename"><code>users/john/_.json</code></figcaption>
  
  <div class="buttons">
    <button class="fa fa-copy clipboard"></button>
  </div>
  <div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="font-weight:bold">&#34;username&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;john&#34;</span>,
  <span style="font-weight:bold">&#34;email&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;johnny@example.org&#34;</span>,
  <span style="font-weight:bold">&#34;first_name&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;John&#34;</span>,
  <span style="font-weight:bold">&#34;last_name&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;Smith&#34;</span>
}</code></pre></td></tr></table>
</div>
</div>
</figure>


<p>which contain some arbitrary metadata about the host <code>server1</code> and the user <code>john</code> respectively.</p>

<p>The files in <code>hosts/server1/etc/ssh/</code> folder contain private and public keys for SSH service on the host. It would be
desired in this example, that the actual SSH service keys, which are presumably kept in <code>/etc/ssh</code> folder on the <code>server1</code>,
should always be identical to those in the file structure. That way, in case of catastrophic hardware failure, the host can be
recreated on another hardware, with identical SSH fingerprint.</p>

<p>As it can be seen from the example, such file set can intuitively and efficiently store in a <em>declarative manner</em> a desired
configuration of the managed infrastructure. By changing some metadata inside the file set (for instance changing IP
address for the hosts) and running Opereon toolchain on the file set, that change should be performed on the actual host
by executing a defined set of administrative tasks (like reconfiguring network interfaces).</p>

<h1 id="data-representation">Data representation</h1>

<p>Files in the model can contain arbitrary JSON-like data (currently supported parsable formats include <a href="https://www.json.org">JSON</a>,
<a href="https://yaml.org">YAML</a> and <a href="https://github.com/toml-lang/toml">TOML</a>).
Other data formats are treated as binary files.</p>

<p>All of the files are transformed into an object tree in memory when in use by Opereon tools. The rules of this
transformation are configurable, as described below.</p>

<h2 id="manifest-file">Manifest file</h2>

<p>At the root of file tree representing data model for Opereon, there must be preset a manifest file. Manifest file is by
default named <code>op.toml</code></p>






<figure class="code" id="op.toml">
  
  <figcaption class="filename"><code>op.toml</code></figcaption>
  
  <div class="buttons">
    <button class="fa fa-copy clipboard"></button>
  </div>
  <div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-toml" data-lang="toml"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-toml" data-lang="toml">[info]
authors = [<span style="color:#0ff;font-weight:bold">&#34;John &lt;johnny@example.org&gt;&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;Mark &lt;mark@example.org&gt;&#34;</span>]
description = <span style="color:#0ff;font-weight:bold">&#34;Server farm 1&#34;</span>

[defines]
users = <span style="color:#0ff;font-weight:bold">&#34;$.conf.users.*&#34;</span>
hosts = <span style="color:#0ff;font-weight:bold">&#34;$.conf.hosts.*&#34;</span>
procs = <span style="color:#0ff;font-weight:bold">&#34;$.(proc, probe).**[@.proc != null]&#34;</span>
user_defined_expr_1 = <span style="color:#0ff;font-weight:bold">&#34;$.**[custom_property == &#39;custom_value&#39;]&#34;</span></code></pre></td></tr></table>
</div>
</div>
</figure>


<h2 id="settings-file">Settings file</h2>

<p>Everywhere in the data model, a user can also define a file named <code>.operc</code>, containing settings used when reading the model
into the object tree. The settings are overwritten by a setting file in hierarchical fashion, for the folder in which the
<code>.operc</code> file is located, and its subfolders, unless further overwritten with nested <code>.operc</code> files.</p>

<p>By default, if no <code>.operc</code> file is present anywhere in the model, the default settings are used, as presented below.</p>






<figure class="code" id=".operc">
  
  <figcaption class="filename"><code>.operc</code></figcaption>
  
  <div class="buttons">
    <button class="fa fa-copy clipboard"></button>
  </div>
  <div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-toml" data-lang="toml"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-toml" data-lang="toml">inherit_excludes = <span style="color:#fff;font-weight:bold">true</span>
inherit_includes = <span style="color:#fff;font-weight:bold">true</span>
inherit_overrides = <span style="color:#fff;font-weight:bold">true</span>

[[exclude]]
path = <span style="color:#0ff;font-weight:bold">&#34;**/.*/**&#34;</span>

[[include]]
path = <span style="color:#0ff;font-weight:bold">&#34;**/*&#34;</span>
file_type = <span style="color:#0ff;font-weight:bold">&#34;dir&#34;</span>
item = <span style="color:#0ff;font-weight:bold">&#34;${map()}&#34;</span>
mapping = <span style="color:#0ff;font-weight:bold">&#34;${$.find(array($item.@file_path_components[..-2]).join(&#39;.&#39;)).set($item.@file_name, $item)}&#34;</span>

[[include]]
path = <span style="color:#0ff;font-weight:bold">&#34;**/_.{yaml,yml,toml,json}&#34;</span>
file_type = <span style="color:#0ff;font-weight:bold">&#34;file&#34;</span>
item = <span style="color:#0ff;font-weight:bold">&#34;${loadFile(@.@file_path, @.@file_ext)}&#34;</span>
mapping = <span style="color:#0ff;font-weight:bold">&#34;${$.find(array($item.@file_path_components[..-2]).join(&#39;.&#39;)).extend($item)}&#34;</span>

[[include]]
path = <span style="color:#0ff;font-weight:bold">&#34;**/*.{yaml,yml,toml,json}&#34;</span>
file_type = <span style="color:#0ff;font-weight:bold">&#34;file&#34;</span>
item = <span style="color:#0ff;font-weight:bold">&#34;${loadFile(@.@file_path, @.@file_ext)}&#34;</span>
mapping = <span style="color:#0ff;font-weight:bold">&#34;${$.find(array($item.@file_path_components[..-2]).join(&#39;.&#39;)).set($item.@file_stem, $item)}&#34;</span>

[[include]]
path = <span style="color:#0ff;font-weight:bold">&#34;**/*&#34;</span>
file_type = <span style="color:#0ff;font-weight:bold">&#34;file&#34;</span>
item = <span style="color:#0ff;font-weight:bold">&#34;${loadFile(@.@file_path, &#39;text&#39;)}&#34;</span>
mapping = <span style="color:#0ff;font-weight:bold">&#34;${$.find(array($item.@file_path_components[..-2]).join(&#39;.&#39;)).set($item.@file_stem, $item)}&#34;</span>

[overrides]
<span style="color:#007f7f"># no overrides</span>
</code></pre></td></tr></table>
</div>
</div>
</figure>


</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li><a href="https://kodegenix.pl"><img src="/images/kodegenix_logo.svg"/></a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>


  
  
  

  
  

  
  <script type="text/javascript" src="/js/bundle.min.29bbece3074d70d9414a91092be21b35bcbf0a5250050a6d25b2bb3cdf4edc77.js"></script>
  

  
  
  
    
      
      <script async src="https://www.googletagmanager.com/gtag/js?id=UA-149427251-1"></script>
      <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-149427251-1');
      </script>
    
  


</body>

</html>
